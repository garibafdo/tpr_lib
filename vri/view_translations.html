<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tipiṭaka Translations</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn.active {
            background: var(--success-color);
        }

        /* Replace the existing .btn.toggle styles with: */
      .btn.toggle {
          background: #95a5a6; /* Default off state */
          position: relative;
      }
      
      .btn.toggle.active {
          background: var(--success-color); /* Green when on */
      }
      
      .btn.toggle::after {
          content: "❌";
          margin-left: 8px;
          font-size: 0.9em;
      }
      
      .btn.toggle.active::after {
          content: "✅";
      }
      
      /* Add this new rule for hidden commentary */
      .commentary-section.hidden {
          display: none !important;
      }

        .stats {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .paragraph {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .paragraph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .para-number {
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .sutta-name {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .section {
            margin: 25px 0;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "•";
            color: var(--accent-color);
            font-size: 1.5em;
        }

        .text-content {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid var(--accent-color);
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        /* Default Pali text (Roman) */
.pali-text {
    border-left-color: #e74c3c;
    font-size: 1em;
    line-height: 1.6;
}

/* When Devanagari is active */
body.devanagari-active .pali-text {
    font-size: 1.2em;
    line-height: 1.8;
}

        .english-text {
            border-left-color: #3498db;
        }

        .commentary-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .commentary-section .section-title {
            color: white;
        }

        .commentary-section .section-title::before {
            color: #f1c40f;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .navigation {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
            
            .controls {
                justify-content: center;
            }
            
            .navigation {
                position: static;
                transform: none;
                flex-direction: row;
                justify-content: center;
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Tipiṭaka Translations</h1>
                <div class="stats" id="stats">Loading...</div>
            </div>
            <div class="controls">
                <button class="btn toggle" onclick="toggleView('pali')">Pali Text</button>
                <button class="btn toggle active" onclick="toggleView('english')">English Translation</button>
                <button class="btn toggle active" onclick="toggleView('commentary')">Commentary</button>
                <button class="btn toggle" onclick="toggleScript()">Devanagari Script</button>
                <button class="btn" onclick="toggleTheme()">Dark/Light</button>
                <button class="btn" onclick="scrollToTop()">Top</button>
            </div>
        </header>

        <div id="content"></div>
    </div>

    <div class="navigation">
        <button class="nav-btn" onclick="scrollToTop()">↑</button>
        <button class="nav-btn" onclick="scrollToBottom()">↓</button>
    </div>
    
    <!-- Add this script -->
<!--
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
-->
<!--
<script src="aksharamukha-v3.js"></script>
-->


<script>
    let translations = [];
    let currentView = {
        pali: true,
        english: true,
        commentary: true,
        devanagari: false
    };

    // Load translations
    fetch('translated_texts.json')
        .then(response => response.json())
        .then(data => {
            translations = data;
            displayTranslations();
            updateStats();
        })
        .catch(error => {
            document.getElementById('content').innerHTML = 
                '<div class="paragraph"><p style="color: red; text-align: center;">Error loading translation data. Make sure translated_texts.json is in the same folder.</p></div>';
        });

    function toggleScript() {
        currentView.devanagari = !currentView.devanagari;
        const btn = event.target;
        btn.classList.toggle('active', currentView.devanagari);
        displayTranslations();  // Refresh the display
    }
    
   
function convertToDevanagari(text) {
    if (!text) return text;
    
    text = text.toLowerCase();
    
    const consonants = {
        'k': 'क', 'kh': 'ख', 'g': 'ग', 'gh': 'घ', 'ṅ': 'ङ',
        'c': 'च', 'ch': 'छ', 'j': 'ज', 'jh': 'झ', 'ñ': 'ञ',
        'ṭ': 'ट', 'ṭh': 'ठ', 'ḍ': 'ड', 'ḍh': 'ढ', 'ṇ': 'ण',
        't': 'त', 'th': 'थ', 'd': 'द', 'dh': 'ध', 'n': 'न',
        'p': 'प', 'ph': 'फ', 'b': 'ब', 'bh': 'भ', 'm': 'म',
        'y': 'य', 'r': 'र', 'l': 'ल', 'v': 'व', 
        'ś': 'श', 'ṣ': 'ष', 's': 'स', 'h': 'ह'
    };
    
    const vowelSigns = {
        'a': '', 'ā': 'ा', 'i': 'ि', 'ī': 'ी', 'u': 'ु', 'ū': 'ू',
        'e': 'े', 'o': 'ो'
    };
    
    const independentVowels = {
        'a': 'अ', 'ā': 'आ', 'i': 'इ', 'ī': 'ई', 'u': 'उ', 'ū': 'ऊ',
        'e': 'ए', 'o': 'ओ'
    };
    
    let result = '';
    let i = 0;
    
    while (i < text.length) {
        const char = text[i];
        
        // Handle special characters
        if (char === 'ṃ' || char === 'ṁ') {
            result += 'ं';
            i++;
            continue;
        }
        if (char === 'ḥ') {
            result += 'ः';
            i++;
            continue;
        }
        if (' ,.?!–-""\'\'‘’“”'.includes(char)) {
            result += char;
            i++;
            continue;
        }
        
        // Check for consonants
        let consonantFound = null;
        let consonantLength = 0;
        
        // Try 2-character consonants first
        if (i + 1 < text.length) {
            const twoChar = char + text[i + 1];
            if (consonants[twoChar]) {
                consonantFound = consonants[twoChar];
                consonantLength = 2;
            }
        }
        
        // Try single character consonants
        if (!consonantFound && consonants[char]) {
            consonantFound = consonants[char];
            consonantLength = 1;
        }
        
        if (consonantFound) {
            const nextIndex = i + consonantLength;
            
            // Check what comes after the consonant
            if (nextIndex < text.length) {
                const nextChar = text[nextIndex];
                
                // If followed by a vowel sign, use it
                if (vowelSigns[nextChar] !== undefined) {
                    result += consonantFound + vowelSigns[nextChar];
                    i += consonantLength + 1;
                } 
                // If followed by another consonant or punctuation, no inherent 'a'
                else if (consonants[nextChar] || ' ,.?!–-'.includes(nextChar)) {
                    result += consonantFound;
                    i += consonantLength;
                }
                // Otherwise, assume inherent 'a'
                else {
                    result += consonantFound;
                    i += consonantLength;
                }
            } else {
                // End of text - no inherent 'a'
                result += consonantFound;
                i += consonantLength;
            }
            continue;
        }
        
        // Check for independent vowels
        if (independentVowels[char]) {
            result += independentVowels[char];
            i++;
            continue;
        }
        
        // Keep anything else as-is
        result += char;
        i++;
    }
    
    return result;
}
       
       
        function displayTranslations() {
    const content = document.getElementById('content');
    content.innerHTML = '';

    translations.forEach((item, index) => {
        const paraDiv = document.createElement('div');
        paraDiv.className = 'paragraph fade-in';
        paraDiv.id = `para-${item.paragraph_number}`;

        const hasCommentary = item.has_commentary && item.commentary_pali;
        
        // Only show commentary section if commentary is enabled AND has content
        const showCommentarySection = currentView.commentary && hasCommentary;
        
        paraDiv.innerHTML = `
            <div class="paragraph-header">
                <div class="para-number">Paragraph ${item.paragraph_number}</div>
                <div class="sutta-name">${item.sutta}</div>
            </div>

            <div class="section ${currentView.pali ? '' : 'hidden'}">
                <div class="section-title">Mūla (Source Text)</div>
                <div class="text-content pali-text">${currentView.devanagari ? convertToDevanagari(item.mula_pali) : escapeHtml(item.mula_pali)}</div>
            </div>

            <div class="section ${currentView.english ? '' : 'hidden'}">
                <div class="section-title">English Translation</div>
                <div class="text-content english-text">${escapeHtml(item.mula_english)}</div>
            </div>

            ${showCommentarySection ? `
            <div class="commentary-section">
                <div class="section-title">Aṭṭhakathā (Commentary)</div>
                
                <div class="section ${currentView.pali ? '' : 'hidden'}">
                    <div class="section-title">Pali Commentary</div>                    
                    <div class="text-content pali-text">${currentView.devanagari ? convertToDevanagari(item.commentary_pali) : escapeHtml(item.commentary_pali)}</div>
                </div>

                <div class="section ${currentView.english ? '' : 'hidden'}">
                    <div class="section-title">English Commentary</div>
                    <div class="text-content english-text">${escapeHtml(item.commentary_english)}</div>
                </div>
            </div>
            ` : ''}
            
            ${!showCommentarySection && hasCommentary ? 
                '<div style="text-align: center; color: #7f8c8d; font-style: italic; padding: 10px;">Commentary available (toggle on to view)</div>' : 
                !hasCommentary ? 
                '<div style="text-align: center; color: #7f8c8d; font-style: italic; padding: 10px;">No commentary available for this paragraph</div>' : ''
            }
        `;

        content.appendChild(paraDiv);
          });
      }

        function toggleView(type) {
            currentView[type] = !currentView[type];
            const buttons = document.querySelectorAll('.btn.toggle');
            buttons.forEach(btn => {
                if (btn.textContent.toLowerCase().includes(type)) {
                    btn.classList.toggle('active', currentView[type]);
                }
            });
            displayTranslations();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            // Save theme preference
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        function updateStats() {
            const stats = document.getElementById('stats');
            const total = translations.length;
            const withCommentary = translations.filter(t => t.has_commentary).length;
            stats.textContent = `${total} paragraphs • ${withCommentary} with commentary`;
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToBottom() {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;")
                .replace(/\n/g, '<br>');
        }

        // Load saved theme
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    </script>
</body>
</html>
